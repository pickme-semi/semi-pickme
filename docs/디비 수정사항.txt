﻿-- 2018.11.08
-- 픽테이블 등록인 수정
ALTER TABLE PM_PICK_TB ADD (USERNO NUMBER);
ALTER TABLE PM_PICK_TB ADD FOREIGN KEY(USERNO) REFERENCES PM_USER_TB(NO);
COMMENT ON COLUMN PM_PICK_TB.USERNO IS '등록한 사용자';
COMMIT;

-- 코드 테이블 수정 '대기' -> '진행'
UPDATE PM_CODE_TB SET VAL = '진행' WHERE ID = 'STA001';

-- 2018.11.09
-- 신고&질문 테이블 삭제
DROP TABLE PM_REPORT_ANSWER_TB;
DROP TABLE PM_REPORT_TB;
DROP TABLE PM_REPORT_CATEGORY_TB;

DROP TABLE  PM_QUESTION_ANSWER_TB;
DROP TABLE  PM_QUESTION_TB;

-- 관련 시퀀스 삭제
DROP SEQUENCE SEQ_RC;
DROP SEQUENCE SEQ_RA;
DROP SEQUENCE SEQ_REPORT;

DROP SEQUENCE SEQ_QA;
DROP SEQUENCE SEQ_QUESTION;

-- 질문&신고 게시판 통합

DROP TABLE PM_BOARD_CATEGORY_TB;
CREATE TABLE PM_BOARD_CATEGORY_TB(
    ID NUMBER PRIMARY KEY,
    CONTENT VARCHAR2(1000) NOT NULL,
    TYPE VARCHAR2(50) CONSTRAINT FK_TYPE_BC REFERENCES PM_CODE_TB(ID) NOT NULL
);

DROP SEQUENCE SEQ_BOARD_CATE_ID;
CREATE SEQUENCE SEQ_BOARD_CATE_ID START WITH 1 INCREMENT BY 1;


COMMENT ON TABLE PM_BOARD_CATEGORY_TB IS '게시판 카테고리 테이블';
COMMENT ON COLUMN PM_BOARD_CATEGORY_TB.ID IS '카테고리 구분 ID';
COMMENT ON COLUMN PM_BOARD_CATEGORY_TB.CONTENT IS '내용';
COMMENT ON COLUMN PM_BOARD_CATEGORY_TB.TYPE IS '게시물 구분타입';

-- 게시판 테이블 (신고&질문)
DROP TABLE PM_BOARD_TB;
CREATE TABLE PM_BOARD_TB(
    ID NUMBER PRIMARY KEY,
    TITLE VARCHAR2(200) NOT NULL,
    CONTENT VARCHAR2(1000) NOT NULL,
    EROLL_DATE DATE NOT NULL,
    STATUS VARCHAR2(50) CONSTRAINT FK_BOARD_STATUSS REFERENCES PM_CODE_TB(ID) NOT NULL,
    CATEGORY_ID NUMBER CONSTRAINT FK_BOARD_CATEE REFERENCES PM_BOARD_CATEGORY_TB(ID) NOT NULL,
    USER_NO NUMBER CONSTRAINT FK_BOARD_USERR REFERENCES PM_USER_TB(NO) NOT NULL,
    PICK_ID NUMBER CONSTRAINT FK_BOARD_PICKK REFERENCES PM_PICK_TB(ID),
    TYPE VARCHAR2(50) CONSTRAINT FK_TYPE_BCC REFERENCES PM_CODE_TB(ID) NOT NULL
);

DROP SEQUENCE SEQ_BOARD_ID;
CREATE SEQUENCE SEQ_BOARD_ID START WITH 1 INCREMENT BY 1;

COMMENT ON TABLE PM_BOARD_TB IS '게시판 테이블';

COMMENT ON TABLE PM_BOARD_TB.ID IS '게시판 구분 ID';
COMMENT ON COLUMN PM_BOARD_TB.TITLE IS '제목';
COMMENT ON COLUMN PM_BOARD_TB.CONTENT IS '본문';
COMMENT ON COLUMN PM_BOARD_TB.EROLL_DATE IS '등록일';
COMMENT ON COLUMN PM_BOARD_TB.STATUS IS '상태';
COMMENT ON COLUMN PM_BOARD_TB.CATEGORY_ID IS '등록 카테고리';
COMMENT ON COLUMN PM_BOARD_TB.USER_NO IS '작성자';
COMMENT ON COLUMN PM_BOARD_TB.PICK_ID IS '신고픽번호';
COMMENT ON COLUMN PM_BOARD_TB.TYPE IS '게시물 구분 타입';

-- 게시판 답변테이블
DROP TABLE PM_BOARD_ANSWER_TB;
CREATE TABLE PM_BOARD_ANSWER_TB(
    ID NUMBER PRIMARY KEY,
    BOARD_ID NUMBER CONSTRAINT FK_BID REFERENCES PM_BOARD_TB(ID) NOT NULL,
    USER_NO NUMBER CONSTRAINT FK_BOARD_ANSWER REFERENCES PM_USER_TB(NO) NOT NULL,
    CONTENT VARCHAR2(1000) NOT NULL,
    ENROLL_DATE DATE NOT NULL
);

DROP SEQUENCE SEQ_BOARD_ANSWER;
CREATE SEQUENCE SEQ_BOARD_ANSWER START WITH 1 INCREMENT BY 1;

COMMENT ON TABLE PM_BOARD_ANSWER_TB IS '게시판 답변 테이블';
COMMENT ON COLUMN PM_BOARD_ANSWER_TB.ID IS '게시물 ID';
COMMENT ON COLUMN PM_BOARD_ANSWER_TB.BOARD_ID IS '원 게시물 ID';
COMMENT ON COLUMN PM_BOARD_ANSWER_TB.USER_NO IS '답변인';
COMMENT ON COLUMN PM_BOARD_ANSWER_TB.CONTENT IS '답변 내용';
COMMENT ON COLUMN PM_BOARD_ANSWER_TB.ENROLL_DATE IS '답변일';

INSERT INTO "PICKMEUSER"."PM_CODE_TB" (ID, VAL) VALUES ('BOT001', '신고');
INSERT INTO "PICKMEUSER"."PM_CODE_TB" (ID, VAL) VALUES ('BOT002', '질문');
INSERT INTO "PICKMEUSER"."PM_CODE_TB" (ID, VAL) VALUES ('BOT003', '공통질문');

COMMIT;

-- 2018.11.13
-- 유저 카테고리에 등록된 상태 추가
ALTER TABLE PM_USER_CATEGORY_TB ADD (STATUS VARCHAR2(50));
ALTER TABLE PM_USER_CATEGORY_TB ADD FOREIGN KEY(STATUS) REFERENCES PM_CODE_TB(ID);
COMMENT ON COLUMN PM_USER_CATEGORY_TB.STATUS IS '카테고리 상태';
COMMIT;

INSERT INTO PM_CODE_TB VALUES('CAT001', '진행');
INSERT INTO PM_CODE_TB VALUES('CAT002', '삭제');
COMMIT;

-- 2018.11.14
-- 컬럼명 변경
ALTER TABLE PM_BOARD_TB RENAME COLUMN EROLL_DATE TO ENROLL_DATE;
COMMIT;

-- 2018.11.20
-- 자기소개 추가
ALTER TABLE PM_USER_TB ADD (USERCOMMENT VARCHAR2(500));
COMMENT ON COLUMN PM_USER_TB.USERCOMMENT IS '자기소개';
COMMIT;

INSERT INTO "PICKMEUSER"."PM_CODE_TB" (ID, VAL) VALUES ('PST001', '획득');
INSERT INTO "PICKMEUSER"."PM_CODE_TB" (ID, VAL) VALUES ('PST002', '사용');

COMMIT;

ALTER TABLE PM_COMMENT_TB ADD (REFCNO NUMBER);
COMMENT ON COLUMN PM_COMMENT_TB.REFCNO IS '대댓글의 부모댓글번호';
COMMIT; 

-- 2018.11.21 
-- 테스트 카테고리

UPDATE PM_CODE_TB SET VAL = '신고' WHERE ID = 'BOT001';
UPDATE PM_CODE_TB SET VAL = '질문' WHERE ID = 'BOT002';


INSERT INTO PM_BOARD_CATEGORY_TB VALUES (SEQ_BOARD_CATE_ID.NEXTVAL, '유해 게시물', 'BOT001');
INSERT INTO PM_BOARD_CATEGORY_TB VALUES (SEQ_BOARD_CATE_ID.NEXTVAL, '저작권 침해 게시물', 'BOT001');
INSERT INTO PM_BOARD_CATEGORY_TB VALUES (SEQ_BOARD_CATE_ID.NEXTVAL, '명예 훼손 게시물', 'BOT001');
INSERT INTO PM_BOARD_CATEGORY_TB VALUES (SEQ_BOARD_CATE_ID.NEXTVAL, '도배', 'BOT001');
INSERT INTO PM_BOARD_CATEGORY_TB VALUES (SEQ_BOARD_CATE_ID.NEXTVAL, '기타', 'BOT001');

INSERT INTO PM_BOARD_CATEGORY_TB VALUES (SEQ_BOARD_CATE_ID.NEXTVAL, '개인정보 관련', 'BOT002');
INSERT INTO PM_BOARD_CATEGORY_TB VALUES (SEQ_BOARD_CATE_ID.NEXTVAL, '게시물 등록 방법', 'BOT002');
INSERT INTO PM_BOARD_CATEGORY_TB VALUES (SEQ_BOARD_CATE_ID.NEXTVAL, '기타', 'BOT002');

COMMIT;

-- 2018.11.22
DROP SEQUENCE SEQ_CATEGORY;
CREATE SEQUENCE SEQ_CATEGORY START WITH 23;
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, NULL, '기타');

-- 대분류
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, NULL, '동물');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, NULL, '뷰티');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, NULL, 'IT');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, NULL, '음식');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, NULL, '패션');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, NULL, '음악');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, NULL, '게임');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, NULL, '도서');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, NULL, '취미');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, NULL, '엔터테이먼트');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, NULL, '가전');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, NULL, '레저');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, NULL, '육아');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, NULL, '생활건강');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, NULL, '가구');


--소분류
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, 33 , '영화');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, 33 , '드라마');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, 33 , '애니메이션');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, 33 , '예능');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, 33 , '공연');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, 33 , '뮤지컬');

INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, 24 , '강아지');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, 24 , '고양이');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, 24 , '새');

INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, 27 , '과일');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, 27 , '육류');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, 27 , '생선');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, 27 , '채소');


INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, 34 , '컴퓨터');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, 34 , '스마트폰');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, 34 , '청소기');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, 34 , '에어컨');
INSERT INTO PM_CATEGORY_TB VALUES (SEQ_CATEGORY.NEXTVAL, 34 , '냉장고');

commit;

INSERT INTO "PICKMEUSER"."PM_POINT_CONTENT_TB" (ID, CONTENT) VALUES ('7', '로그인')
