﻿-- 2018.11.08
-- 픽테이블 등록인 수정
ALTER TABLE PM_PICK_TB ADD (USERNO NUMBER);
ALTER TABLE PM_PICK_TB ADD FOREIGN KEY(USERNO) REFERENCES PM_USER_TB(NO);
COMMENT ON COLUMN PM_PICK_TB.USERNO IS '등록한 사용자';
COMMIT;

-- 코드 테이블 수정 '대기' -> '진행'
UPDATE PM_CODE_TB SET VAL = '진행' WHERE ID = 'STA001';

-- 2018.11.09
-- 신고&질문 테이블 삭제
DROP TABLE PM_REPORT_ANSWER_TB;
DROP TABLE PM_REPORT_TB;
DROP TABLE PM_REPORT_CATEGORY_TB;

DROP TABLE  PM_QUESTION_ANSWER_TB;
DROP TABLE  PM_QUESTION_TB;

-- 관련 시퀀스 삭제
DROP SEQUENCE SEQ_RC;
DROP SEQUENCE SEQ_RA;
DROP SEQUENCE SEQ_REPORT;

DROP SEQUENCE SEQ_QA;
DROP SEQUENCE SEQ_QUESTION;

-- 질문&신고 게시판 통합

DROP TABLE PM_BOARD_CATEGORY_TB;
CREATE TABLE PM_BOARD_CATEGORY_TB(
    ID NUMBER PRIMARY KEY,
    CONTENT VARCHAR2(1000) NOT NULL,
    TYPE VARCHAR2(50) CONSTRAINT FK_TYPE_BC REFERENCES PM_CODE_TB(ID) NOT NULL
);

DROP SEQUENCE SEQ_BOARD_CATE_ID;
CREATE SEQUENCE SEQ_BOARD_CATE_ID START WITH 1 INCREMENT BY 1;


COMMENT ON TABLE PM_BOARD_CATEGORY_TB IS '게시판 카테고리 테이블';
COMMENT ON COLUMN PM_BOARD_CATEGORY_TB.ID IS '카테고리 구분 ID';
COMMENT ON COLUMN PM_BOARD_CATEGORY_TB.CONTENT IS '내용';
COMMENT ON COLUMN PM_BOARD_CATEGORY_TB.TYPE IS '게시물 구분타입';

-- 게시판 테이블 (신고&질문)
DROP TABLE PM_BOARD_TB;
CREATE TABLE PM_BOARD_TB(
    ID NUMBER PRIMARY KEY,
    TITLE VARCHAR2(200) NOT NULL,
    CONTENT VARCHAR2(1000) NOT NULL,
    EROLL_DATE DATE NOT NULL,
    STATUS VARCHAR2(50) CONSTRAINT FK_BOARD_STATUSS REFERENCES PM_CODE_TB(ID) NOT NULL,
    CATEGORY_ID NUMBER CONSTRAINT FK_BOARD_CATEE REFERENCES PM_BOARD_CATEGORY_TB(ID) NOT NULL,
    USER_NO NUMBER CONSTRAINT FK_BOARD_USERR REFERENCES PM_USER_TB(NO) NOT NULL,
    PICK_ID NUMBER CONSTRAINT FK_BOARD_PICKK REFERENCES PM_PICK_TB(ID),
    TYPE VARCHAR2(50) CONSTRAINT FK_TYPE_BCC REFERENCES PM_CODE_TB(ID) NOT NULL
);

DROP SEQUENCE SEQ_BOARD_ID;
CREATE SEQUENCE SEQ_BOARD_ID START WITH 1 INCREMENT BY 1;

COMMENT ON TABLE PM_BOARD_TB IS '게시판 테이블';

COMMENT ON TABLE PM_BOARD_TB.ID IS '게시판 구분 ID';
COMMENT ON COLUMN PM_BOARD_TB.TITLE IS '제목';
COMMENT ON COLUMN PM_BOARD_TB.CONTENT IS '본문';
COMMENT ON COLUMN PM_BOARD_TB.EROLL_DATE IS '등록일';
COMMENT ON COLUMN PM_BOARD_TB.STATUS IS '상태';
COMMENT ON COLUMN PM_BOARD_TB.CATEGORY_ID IS '등록 카테고리';
COMMENT ON COLUMN PM_BOARD_TB.USER_NO IS '작성자';
COMMENT ON COLUMN PM_BOARD_TB.PICK_ID IS '신고픽번호';
COMMENT ON COLUMN PM_BOARD_TB.TYPE IS '게시물 구분 타입';

-- 게시판 답변테이블
DROP TABLE PM_BOARD_ANSWER_TB;
CREATE TABLE PM_BOARD_ANSWER_TB(
    ID NUMBER PRIMARY KEY,
    BOARD_ID NUMBER CONSTRAINT FK_BID REFERENCES PM_BOARD_TB(ID) NOT NULL,
    USER_NO NUMBER CONSTRAINT FK_BOARD_ANSWER REFERENCES PM_USER_TB(NO) NOT NULL,
    CONTENT VARCHAR2(1000) NOT NULL,
    ENROLL_DATE DATE NOT NULL
);

DROP SEQUENCE SEQ_BOARD_ANSWER;
CREATE SEQUENCE SEQ_BOARD_ANSWER START WITH 1 INCREMENT BY 1;

COMMENT ON TABLE PM_BOARD_ANSWER_TB IS '게시판 답변 테이블';
COMMENT ON COLUMN PM_BOARD_ANSWER_TB.ID IS '게시물 ID';
COMMENT ON COLUMN PM_BOARD_ANSWER_TB.BOARD_ID IS '원 게시물 ID';
COMMENT ON COLUMN PM_BOARD_ANSWER_TB.USER_NO IS '답변인';
COMMENT ON COLUMN PM_BOARD_ANSWER_TB.CONTENT IS '답변 내용';
COMMENT ON COLUMN PM_BOARD_ANSWER_TB.ENROLL_DATE IS '답변일';

INSERT INTO "PICKMEUSER"."PM_CODE_TB" (ID, VAL) VALUES ('BOT001', '신고');
INSERT INTO "PICKMEUSER"."PM_CODE_TB" (ID, VAL) VALUES ('BOT002', '질문');
INSERT INTO "PICKMEUSER"."PM_CODE_TB" (ID, VAL) VALUES ('BOT003', '공통질문');

COMMIT;

-- 2018.11.13
-- 유저 카테고리에 등록된 상태 추가
ALTER TABLE PM_USER_CATEGORY_TB ADD (STATUS VARCHAR2(50));
ALTER TABLE PM_USER_CATEGORY_TB ADD FOREIGN KEY(STATUS) REFERENCES PM_CODE_TB(ID);
COMMENT ON COLUMN PM_USER_CATEGORY_TB.STATUS IS '카테고리 상태';
COMMIT;

INSERT INTO PM_CODE_TB VALUES('CAT001', '진행');
INSERT INTO PM_CODE_TB VALUES('CAT002', '삭제');
COMMIT;